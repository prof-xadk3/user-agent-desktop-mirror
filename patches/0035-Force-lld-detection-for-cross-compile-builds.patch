From: Jenkins <jenkins@magrathea>
Date: Fri, 10 Feb 2023 23:24:17 +0100
Subject: Force lld detection for cross compile builds

This should be remove with Firefox 110
---
 build/clang-plugin/Makefile.in          | 2 +-
 build/moz.configure/toolchain.configure | 5 ++++-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/build/clang-plugin/Makefile.in b/build/clang-plugin/Makefile.in
index 57c0cd0806..b4c9d40de0 100644
--- a/build/clang-plugin/Makefile.in
+++ b/build/clang-plugin/Makefile.in
@@ -4,7 +4,7 @@
 
 include $(topsrcdir)/config/config.mk
 
-HOST_LDFLAGS := $(LLVM_LDFLAGS) $(CLANG_LDFLAGS)
+HOST_LDFLAGS += $(LLVM_LDFLAGS) $(CLANG_LDFLAGS)
 
 ifeq ($(HOST_OS_ARCH),WINNT)
 # clang-plugin.dll needs to be deterministic for sccache hashes
diff --git a/build/moz.configure/toolchain.configure b/build/moz.configure/toolchain.configure
index 7a31090073..3ab02ca825 100755
--- a/build/moz.configure/toolchain.configure
+++ b/build/moz.configure/toolchain.configure
@@ -1658,7 +1658,10 @@ def select_linker_tmpl(host_or_target):
             result = try_linker("lld")
         elif (
             linker is None
-            and developer_options
+            and (
+                developer_options
+                or (host_or_target_str == "host" and c_compiler.type == "clang")
+            )
             and (result is None or result.KIND in ("bfd", "gold"))
         ):
             # try and use lld if available.
-- 
2.37.1 (Apple Git-137.1)

